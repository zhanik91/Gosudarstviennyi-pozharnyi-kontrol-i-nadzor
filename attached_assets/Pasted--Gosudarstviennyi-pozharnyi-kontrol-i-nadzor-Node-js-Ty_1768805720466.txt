Ты работаешь в репозитории Gosudarstviennyi-pozharnyi-kontrol-i-nadzor (Node.js/TypeScript, React/Vite, PostgreSQL + Drizzle ORM). :contentReference[oaicite:0]{index=0}\n\nЗадача: внедрить инициализацию оргструктуры и RBAC/Scope-доступа для МЧС/ДЧС/Районов, а также создать учетки на основе таблицы (Excel/CSV), чтобы:\n1) МЧС (центральный орган) видит ВСЕ данные.\n2) Каждый ДЧС видит ТОЛЬКО данные своей области/города (и все районы внутри нее).\n3) Каждый район видит ТОЛЬКО свои данные.\nВсе журналы/отчеты/учет пожаров и т.п. должны быть привязаны к оргединице (району) и автоматически фильтроваться.\n\nВходные данные:\n- файл generated_accounts.csv (или generated_accounts.xlsx) лежит локально в корне проекта, НЕ коммитить его в git.\n- В CSV есть колонки: level, role, region, unit, username, temp_password, must_change_on_first_login\n- Учётка МЧС уже создана — не менять пароль и не удалять, но роль MCHS и полный доступ должны быть гарантированы.\n\nТребования к модели данных (PostgreSQL + Drizzle):\nA) Создай таблицу org_units (или эквивалент):\n   - id (uuid/serial), type ENUM('MCHS','DCHS','DISTRICT')\n   - name (text)\n   - parent_id (nullable) -> org_units.id\n   - region_name (text, для удобства отчетности)\n   - unit_name (text, для района)\n   - уникальность: (type,name,parent_id) или отдельные unique для предотвращения дублей\n   - индексы по (type), (parent_id), (region_name)\n\nB) Таблица users (если уже есть — расширь):\n   - id, username UNIQUE\n   - password_hash (bcrypt/argon2)\n   - role ENUM('MCHS','DCHS','DISTRICT')\n   - org_unit_id FK -> org_units.id\n   - must_change_on_first_login boolean default true\n   - created_at/updated_at\n   Важно: хранить только хеш пароля, не plaintext.\n\nC) Все доменные таблицы, которые содержат данные по пожарам/журналам/отчетам (например fire_* / journals / reports и т.д.):\n   - должны иметь org_unit_id (районный уровень) FK -> org_units.id\n   - опционально region_org_unit_id (ДЧС) можно хранить для ускорения, но можно вычислять через parent_id\n   - добавь индексы по org_unit_id (и по region_org_unit_id если добавишь)\n\nМиграции:\n- добавь миграции Drizzle (в migrations) и обнови schema в серверной части.\n- обеспечь, что миграции не ломают существующие данные: если уже есть записи — проставь org_unit_id через разумное правило (если пока невозможно — оставь nullable и добавь последующую миграцию + TODO, но API должен корректно обрабатывать null).\n\nСкрипт импорта/создания учеток:\n1) Добавь скрипт (например scripts/seed-org-and-users.ts):\n   - читает generated_accounts.csv\n   - создает org_units:\n     - одна запись MCHS (если нет)\n     - для каждого региона (DCHS) создать org_unit type='DCHS'\n     - для каждой строки района создать org_unit type='DISTRICT' с parent_id на соответствующий DCHS\n   - создает users:\n     - для каждой строки CSV создать пользователя username, role, org_unit_id\n     - temp_password хешировать (bcrypt/argon2)\n     - must_change_on_first_login выставить из CSV\n   - идемпотентность: повторный запуск не должен плодить дубли (используй upsert/unique keys)\n\n2) Скрипт НЕ должен коммитить и не должен писать пароли в логи, кроме режима explicit --print-credentials (по умолчанию выключен).\n3) Добавь в .gitignore: generated_accounts.* и любые файлы с паролями.\n\nRBAC + Scope в API:\n- В middleware авторизации добавь вычисление scope:\n  - role=MCHS: без фильтра\n  - role=DCHS: фильтровать все запросы по parent region org_unit_id (или по region_org_unit_id)\n  - role=DISTRICT: фильтровать по org_unit_id пользователя\n- Реализуй единый helper applyScope(query, user) для Drizzle, чтобы избежать расхождений.\n- Запрети доступ к чужим данным на уровне серверных запросов (не только на фронтенде).\n\nИзменения в UI:\n- В списках/таблицах/дашбордах показывай только разрешенные записи.\n- Если есть фильтры выбора региона/района:\n  - MCHS видит все регионы/районы\n  - DCHS видит только свои районы (регион фиксирован)\n  - Район не видит выбора — всегда фиксирован на себя\n\nТесты/проверки:\n- Добавь минимальные интеграционные тесты или хотя бы unit-тесты middleware:\n  - MCHS получает все\n  - DCHS не видит чужой регион\n  - Район не видит чужой район\n- Добавь quick sanity check в seed: количество созданных DCHS = 20, районов = 227, пользователей = 247.\n\nКритерии приемки:\n1) После seed в БД есть 20 DCHS org_units и 227 DISTRICT org_units, и соответствующие users.\n2) Любой API-эндпоинт, возвращающий журналы/пожары/отчеты, автоматически ограничен по роли.\n3) Невозможно получить/изменить запись чужого района/региона ни через UI, ни через прямой вызов API.\n4) Пароли в БД только в виде хеша; при первом входе must_change_on_first_login принуждает смену пароля.