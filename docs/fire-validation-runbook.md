# Runbook: полная проверка журнала происшествий и автозаполнения форм

Этот runbook фиксирует, как воспроизвести «полный прогон» после доработок по журналу происшествий и формам 1–7.

## 1) Предусловия

- Установлены зависимости (`node_modules` уже должен быть подготовлен).
- Для запуска серверно-зависимых скриптов должен быть задан `DATABASE_URL`.
  - Для регрессионного скрипта `verify-fire-gap-closure.ts` допустим любой валидный URL, потому что доступ к БД заглушается в рантайме.

## 2) Быстрый регрессионный прогон

### 2.1 Unit-тесты

```bash
npm test
```

Ожидание:
- проходят тесты по маппингу CO-формы;
- проходят тесты по справочникам пострадавших;
- проходят тесты по структуре строк формы 5.

### 2.2 Сценарная проверка форм 1/2/3/4/5/6/7

```bash
DATABASE_URL=postgres://user:pass@localhost:5432/db npx tsx scripts/verify-fire-gap-closure.ts
```

Ожидание:
- вывод по сценариям `fire`, `nonfire`, `steppe_fire`, `steppe_smolder`, `co_nofire`;
- в конце `All checks passed`.

Примечание:
- предупреждения `[Form7CO:ObjectMapping] Unrecognized object code...` в сценарии `co_nofire` ожидаемы и являются контролируемой проверкой fallback-ветки (`5.12`/`15.12`).

## 3) Полная статическая проверка TypeScript

```bash
npm run check
```

Текущий статус в репозитории:
- команда фиксирует исторические TS-ошибки в несвязанных модулях;
- это не блокирует целевую проверку маппингов форм и сценарной регрессии, но требует отдельного техдолг-цикла.

## 4) Критерии приемки для задачи по журналу происшествий

Считать задачу принятой, если одновременно выполняются пункты:

1. `npm test` зелёный.
2. `verify-fire-gap-closure.ts` зелёный (`All checks passed`).
3. В отчёте `docs/fire-gap-closure-report.md` зафиксированы:
   - контрольные сценарии;
   - ключевые строки по формам;
   - остаточные риски.
4. Матрица `docs/fire-incident-form-matrix.md` актуальна и используется как эталон.
